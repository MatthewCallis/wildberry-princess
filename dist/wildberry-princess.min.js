(function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};t=function(){function t(t){null==t&&(t={}),this.clearIdentity=e(this.clearIdentity,this),this.identify=e(this.identify,this),this.setKM=e(this.setKM,this),this.set=e(this.set,this),this.trackEcommerce=e(this.trackEcommerce,this),this.trackPageView=e(this.trackPageView,this),this.trackEventKM=e(this.trackEventKM,this),this.trackEventGA=e(this.trackEventGA,this),this.trackEvent=e(this.trackEvent,this),this.clickHandler=e(this.clickHandler,this),this.trackUserActions=e(this.trackUserActions,this),this.settings=this.merge(i,t)}var i;return i={useGoogleAnalytics:!0,useKissMetrics:!0},t.prototype.getLabel=function(t){return t.getAttribute("data-event-label")},t.prototype.trackUserActions=function(t,e,i,n,s){var r,o,a,c;for(a={category:e,action:i||"Click"},n&&(a.label=n),s&&(a.value=s),r=document.querySelectorAll(t),o=0,c=[];o<r.length;)r[o].data={eventParams:a},r[o].removeEventListener("click",this.clickHandler),r[o].addEventListener("click",this.clickHandler,!1),c.push(o++);return c},t.prototype.clickHandler=function(t){var e,i,n,s,r;t&&(e=t.target,i=null!=(r=e.data)?r.eventParams:void 0,i&&((n=i.label)||(n=this.getLabel(e)),this.settings.useGoogleAnalytics&&(s={hitType:"event",eventCategory:i.category,eventAction:i.action},n&&(s.eventLabel=n),i.value&&(s.eventValue=i.value),this.sendPayloadGA(s)),this.settings.useKissMetrics&&(n=i.category+" "+n+" "+i.action,s={category:i.category,action:i.action},n&&(s.label=n),i.value&&(s.value=i.value),this.trackEventKM(n,s))))},t.prototype.trackEvent=function(t,e,i,n){var s;return this.settings.useGoogleAnalytics&&this.trackEventGA(t,e,i,n),this.settings.useKissMetrics?(i=t+" "+i+" "+e,s={category:t,action:e},i&&(s.label=i),n&&(s.value=n),this.trackEventKM(i,s)):void 0},t.prototype.trackEventGA=function(t,e,i,n){var s;return s={hitType:"event",eventCategory:t,eventAction:e},i&&(s.eventLabel=i),n&&(s.eventValue=n),this.sendPayloadGA(s)},t.prototype.trackEventKM=function(t,e){return this.sendPayloadKM("record",t,e)},t.prototype.trackPageView=function(t,e){var i;return t||(t=window.location.pathname),e||(e=document.title),i={hitType:"pageview",page:t,title:e},this.sendPayloadGA(i)},t.prototype.trackEcommerce=function(t,e){return null!=window.ga&&this.settings.useGoogleAnalytics?window.ga("ecommerce:"+t,e):void 0},t.prototype.set=function(t,e){return this.settings.useGoogleAnalytics&&this.setGA(t,e),this.settings.useKissMetrics?this.setKM(t,e):void 0},t.prototype.setGA=function(t,e){return null!=window.ga?window.ga("set",t,e):void 0},t.prototype.setKM=function(t,e){var i;return i={},i[t]=e,this.sendPayloadKM("set",i,null)},t.prototype.identify=function(t){return null==t&&(t="anonymous"),this.settings.useGoogleAnalytics&&"anonymous"!==t&&this.setGA("userId",t),this.settings.useKissMetrics?this.sendPayloadKM("identify",t):void 0},t.prototype.clearIdentity=function(){return this.settings.useKissMetrics?this.sendPayloadKM("clearIdentity"):void 0},t.prototype.sendPayloadGA=function(t){return null!=window.ga?window.ga("send",t):void 0},t.prototype.sendPayloadKM=function(t,e,i){var n;return null!=window._kmq?(n=[t],e&&n.push(e),i&&n.push(i),window._kmq.push(n)):void 0},t.prototype.merge=function(t,e){var i,n,s;n=JSON.parse(JSON.stringify(t));for(i in e)s=e[i],n[i]=s;return n},t}(),("undefined"!=typeof exports&&null!==exports?exports:this).WildberryPrincess=t}).call(this);